import { parseMCPIni } from "./config/mcpConfig";
import { atcsDecode } from "./decoding/atcsDecoder";

const mcps = parseMCPIni("../../ignore/BNSF_Belen_Area-20210309.mcp");

const packet0 = new Uint8Array([
  0x23,
  0x14,
  0x05,
  0xcf,
  0x8f,
  0x60,
  0x00,
  0x20,
  0x00,
  0xea,
  0x2a,
  0xa1,
  0x16,
  0x54,
  0x21,
  0x7a,
  0xa1,
  0x42,
  0x1a,
  0xa8,
  0xa2,
  0xa2,
  0x00,
  0xe0,
  0x02,
  0x02,
  0x12,
  0x8b,
  0x03,
  0x00,
  0x01,
  0x08,
  0x19,
  0xa1,
  0x68,
]);

const packet1 = new Uint8Array([
  0x05,
  0x04,
  0x05,
  0xbc,
  0xcf,
  0x64,
  0x00,
  0x22,
  0x00,
  0xae,
  0x7a,
  0xa1,
  0x42,
  0x1a,
  0xa9,
  0xa2,
  0xa2,
  0x2a,
  0xa1,
  0xa1,
  0x54,
  0x21,
  0x00,
  0xa0,
  0x02,
  0x02,
  0x12,
  0x01,
  0x03,
  0x00,
  0x03,
  0x08,
  0x00,
  0x02,
  0x00,
  0xd4,
  0xfc,
]);

const packet2 = new Uint8Array([
  0x05,
  0x04,
  0x05,
  0xbc,
  0xcf,
  0x64,
  0x00,
  0x06,
  0x00,
  0xae,
  0x7a,
  0xa1,
  0x42,
  0x1a,
  0x15,
  0xa2,
  0xa2,
  0x2a,
  0xa1,
  0xa1,
  0x54,
  0x21,
  0x00,
  0x72,
  0x02,
  0x02,
  0x12,
  0x01,
  0x03,
  0x00,
  0x03,
  0x08,
  0x00,
  0x02,
  0x00,
  0x6a,
  0x8a,
]);

const packet3 = new Uint8Array([
  0x23,
  0x38,
  0x06,
  0xc7,
  0x37,
  0x64,
  0x00,
  0x2e,
  0x24,
  0xea,
  0x2a,
  0x22,
  0x1a,
  0x54,
  0x21,
  0x7a,
  0x22,
  0x42,
  0x1a,
  0xa2,
  0xa2,
  0xa2,
  0x00,
  0xc4,
  0x02,
  0x02,
  0x12,
  0x8b,
  0x03,
  0x00,
  0x04,
  0x08,
  0x59,
  0x00,
  0x00,
  0x00,
  0xe1,
  0xc2,
]);

[packet0, packet1, packet2, packet3].forEach((packet) => {
  // Ignore first 4 bytes and last 2 (TODO: not sure why)
  // +1 for ATCSmon type bit
  const result = atcsDecode(packet.slice(5), mcps);

  console.log(JSON.stringify(result));
});
